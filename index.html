<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PROMISE v20 ULTRA</title>
    <!-- FIXED: Full Stable Mobile CDN Link -->
    <script src="https://cdn.jsdelivr.net"></script>
    <style>
        :root { --aura: #00d4ff; --bg: #000; --panel: #050505; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; height: 100vh; display: flex; justify-content: center; align-items: center; overflow: hidden; }
        #chat-container { width: 95vw; max-width: 400px; height: 90vh; background: var(--panel); border: 2px solid var(--aura); border-radius: 25px; display: flex; flex-direction: column; box-shadow: 0 0 30px var(--aura); }
        #header { padding: 15px; border-bottom: 1px solid #222; display: flex; align-items: center; gap: 10px; background: #080808; border-top-left-radius: 25px; border-top-right-radius: 25px; }
        /* High-tech Robot Avatar */
        .avatar { width: 40px; height: 40px; border-radius: 50%; border: 1px solid var(--aura); background: url('https://api.dicebear.com') center/cover; }
        #messages { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 12px; border-radius: 15px; font-size: 14px; max-width: 80%; line-height: 1.4; word-wrap: break-word; }
        .bot { background: #111; border-left: 3px solid var(--aura); align-self: flex-start; color: #e0f7fa; }
        .user { background: #007bff; align-self: flex-end; color: white; }
        #input-area { padding: 15px; background: #080808; display: flex; gap: 10px; border-top: 1px solid #222; border-bottom-left-radius: 25px; border-bottom-right-radius: 25px; }
        input { flex: 1; background: #111; border: 1px solid #333; color: white; padding: 12px; border-radius: 10px; outline: none; font-size: 16px; }
        button { background: none; border: none; font-size: 24px; cursor: pointer; color: var(--aura); }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 5px; background: orange; }
    </style>
</head>
<body onclick="voiceOn()">

<div id="chat-container">
    <div id="header">
        <div class="avatar"></div>
        <div>
            <div style="color:var(--aura); font-weight:bold; font-size: 14px;">PROMISE v20 ULTRA</div>
            <div style="font-size:10px;"><span id="dot" class="status-dot"></span><span id="st-text">CONNECTING...</span></div>
        </div>
    </div>
    <div id="messages"></div>
    <div id="input-area">
        <input type="text" id="ui" placeholder="Commands..." autocomplete="off">
        <button onclick="execute()">ðŸš€</button>
    </div>
</div>

<script>
    // 1. CONFIG (Using your active key)
    const API_KEY = "AIzaSyBlZys1wfw7c7LExxZufItlKjHY8ichoeI"; 
    let chatSession;
    let audioReady = false;

    function voiceOn() { audioReady = true; }

    const box = document.getElementById("messages");
    const ui = document.getElementById("ui");
    const dot = document.getElementById("dot");
    const stText = document.getElementById("st-text");

    function addMsg(text, type) {
        const d = document.createElement("div");
        d.className = "msg " + type;
        d.innerText = text;
        box.appendChild(d);
        box.scrollTop = box.scrollHeight;
        if(type === 'bot' && audioReady) {
            const s = new SpeechSynthesisUtterance(text);
            s.pitch = 0.8;
            window.speechSynthesis.speak(s);
        }
        return d;
    }

    // 2. CONNECT TO GOOGLE BRAIN
    async function connectBrain() {
        try {
            // Check if library is available
            if (!window.googleGenerativeAi) {
                throw new Error("Library failed to load. Check your internet.");
            }

            const { GoogleGenerativeAI } = window.googleGenerativeAi;
            const genAI = new GoogleGenerativeAI(API_KEY);
            const model = genAI.getGenerativeModel({ 
                model: "gemini-1.5-flash",
                systemInstruction: "You are Promise v20 Ultra, a high-tech AI brain developed by Mulenga Jackson. Be concise and sharp. Jackson is your master creator."
            });

            chatSession = model.startChat({ history: [] });
            
            dot.style.background = "#00ff88";
            stText.innerText = "BRAIN ACTIVE";
            addMsg("Master Jackson, PROMISE core online. System standing by.", "bot");
        } catch (e) {
            dot.style.background = "red";
            stText.innerText = "ERROR";
            alert("BRAIN ERROR: " + e.message);
        }
    }

    // 3. EXECUTE AI COMMANDS
    async function execute() {
        const prompt = ui.value.trim();
        if (!prompt || !chatSession) return;

        addMsg(prompt, "user");
        ui.value = "";

        const loading = addMsg("Thinking...", "bot");

        try {
            const result = await chatSession.sendMessage(prompt);
            const response = await result.response;
            loading.innerText = response.text();
        } catch (err) {
            loading.innerText = "Connection failed.";
            alert("AI Error: " + err.message);
        }
    }

    ui.addEventListener("keypress", (e) => { if(e.key === "Enter") execute(); });
    window.onload = connectBrain;
</script>
</body>
</html>
